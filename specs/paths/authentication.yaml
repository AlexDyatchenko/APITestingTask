v3-login:
  post:
    tags:
      - Authentication
    summary: Log in With Username and Password
    description: |
      Logs a user in to the Megaport Portal when they supply a valid username and password.

      This endpoint is called to log an existing user into the system. The endpoint can accept 
      either an encoded password or a plain text password. If multi-factor authentication is 
      enabled on the account, then a valid oneTimePassword value must be provided.

      **Note**: If you receive error code 409 Conflict in a response when using this endpoint,
      it means that the user's email address has not yet been verified. The email address will 
      need to be verified first using the instructions in the Setting Up a Megaport Account section.

      For more information, see: https://docs.megaport.com/setting-up/
    operationId: loginV3
    requestBody:
      required: true
      content:
        application/x-www-form-urlencoded:
          schema:
            type: object
            properties:
              username:
                type: string
                format: email
                description: User's username (email) that will be used to log in
                example: "megaport.newuser@abcd.com"
              password:
                type: string
                format: password
                description: User's plain text password (Required if encodedPassword is not provided)
                example: "Dfjhgedcifk@!23"
              encodedPassword:
                type: string
                description: Base64 encoded password (Required if password is not provided)
              oneTimePassword:
                type: string
                pattern: '^\d{6}$'
                description: Multi-factor authentication code (required if MFA is enabled)
                example: "123456"
            required:
              - username
        application/json:
          schema:
            $ref: "../components/schemas/LoginRequest.yaml"
    responses:
      "200":
        description: Login successful
        content:
          application/json:
            schema:
              $ref: "../components/schemas/LoginResponse.yaml"
            examples:
              success:
                summary: Successful login
                value:
                  message: "Login successfully"
                  terms: "This data is subject to the Acceptable Use Policy https://www.megaport.com/legal/acceptable-use-policy"
                  data:
                    username: "megaport.newuser@abcd.com"
                    firstName: "John"
                    lastName: "Doe"
                    companyName: "Public Access"
                    personId: 47501
                    personUid: "379473d7-ebc8-455e-bffa-370f9378240c"
                    companyId: 1269
                    companyUid: "bec27ded-29fb-43dd-8df8-894eb5ca1e98"
                    email: "megaport.newuser@abcd.com"
                    fullName: "John Doe"
                    requireTotp: false
                    oAuthToken:
                      accessToken: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9..."
                      tokenType: "Bearer"
                      expiresIn: 1000
      "400":
        $ref: "../megaport-api.yaml#/components/responses/BadRequest"
      "401":
        $ref: "../megaport-api.yaml#/components/responses/Unauthorized"
      "409":
        description: Conflict - Email address not verified
        content:
          application/json:
            schema:
              $ref: "../components/schemas/ErrorResponse.yaml"
            example:
              message: "Email address has not been verified"
              terms: "This data is subject to the Acceptable Use Policy https://www.megaport.com/legal/acceptable-use-policy"
      "500":
        $ref: "../megaport-api.yaml#/components/responses/ServerError"
      "503":
        $ref: "../megaport-api.yaml#/components/responses/ServiceUnavailable"
    security: []
